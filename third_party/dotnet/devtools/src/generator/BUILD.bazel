load("//dotnet:executable-assembly.bzl", "csharp_executable")
load("//dotnet:assembly-info.bzl", "generated_assembly_info")
load(
    "//dotnet:selenium-dotnet-version.bzl",
    "ASSEMBLY_COMPANY",
    "ASSEMBLY_COPYRIGHT",
    "ASSEMBLY_INFORMATIONAL_VERSION",
    "ASSEMBLY_PRODUCT",
    "ASSEMBLY_VERSION",
    "SE_VERSION",
    "SUPPORTED_NET_FRAMEWORKS",
    "SUPPORTED_NET_STANDARD_VERSIONS",
)

generated_assembly_info(
    name = "assembly-info",
    company = ASSEMBLY_COMPANY,
    copyright = ASSEMBLY_COPYRIGHT,
    description = "Selenium DevTools Protocol Code Generator",
    informational_version = ASSEMBLY_INFORMATIONAL_VERSION,
    product = ASSEMBLY_PRODUCT,
    title = "Selenium DevTools Protocol Code Generator",
    version = ASSEMBLY_VERSION,
)

csharp_executable(
    name = "generator",
    srcs = glob([
        "*.cs",
        "CodeGen/**/*.cs",
        "Converters/**/*.cs",
        "ProtocolDefinition/**/*.cs"
    ]) + [":assembly-info"],
    out = "DevToolsGenerator",
    target_frameworks = [
        "netcoreapp3.1",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "@json.net//:Newtonsoft.Json",
        "@handlebars//:Handlebars",
        "@humanizer//:Humanizer",
        "@dependencyinjection//:Microsoft.Extensions.DependencyInjection",
        "@dependencyinjectionabstractions//:Microsoft.Extensions.DependencyInjection.Abstractions",
        "@commandlineparser//:CommandLine",
    ],
    is_windows = select({
        "@bazel_tools//src/conditions:host_windows": True,
        "//conditions:default": False,
    }),
)
