<!DOCTYPE html>
<html>
<head>
  <title>pageloading_test</title>
  <script src="webdriver-bootstrap.js"></script>
  <script src="testbase.js"></script>
  <script>
    function setUpPage() {
      openTestWindow();
    }


    function tearDownPage() {
      closeTestWindow();
    }


    function setUp(driver) {
      switchToTestWindow(driver);
    }


function testShouldWaitForDocumentToBeLoaded(driver) {
  driver.get(TEST_PAGE.simpleTestPage);
  assertThat(driver.getTitle(), equals("Hello WebDriver"));
}


function testShouldFollowRedirectsSentInTheHttpResponseHeaders(driver) {
  driver.get(TEST_PAGE.redirectPage);
  assertThat(driver.getTitle(), equals("We Arrive Here"));
}


function testShouldFollowMetaRedirects(driver) {
  driver.get(TEST_PAGE.metaRedirectPage);
  assertThat(driver.getTitle(), equals("We Arrive Here"));
}


function testShouldBeAbleToGetAFragmentOnTheCurrentPage(driver) {
  driver.get(TEST_PAGE.xhtmlTestPage);
  driver.get(TEST_PAGE.xhtmlTestPage + "#text");
}


function testShouldReturnWhenGettingAUrlThatDoesNotResolve(driver) {
  // Of course, we're up the creek if this ever does get registered
  driver.get("http://www.thisurldoesnotexist.comx/");
}


function testShouldReturnWhenGettingAUrlThatDoesNotConnect(driver) {
  // Here's hoping that there's nothing here. There shouldn't be
  driver.get("http://localhost:3001");
}


function testShouldBeAbleToLoadAPageWithFramesetsAndWaitUntilAllFramesAreLoaded(
    driver) {
  driver.get(TEST_PAGE.framesetPage);
  driver.switchToFrame(0);
  var pageNumber = driver.findElement({id: 'pageNumber'});
  assertThat(pageNumber.getText(), equals("1"));

  driver.switchToFrame(1);
  assertThat(driver.findElement({id: 'pageNumber'}).getText(), equals('2'));
}


function testShouldDoNothingIfThereIsNothingToGoBackTo(driver) {
  driver.callFunction(function() {
    window.open('', 'a_clean_test_window');
  });
  driver.switchToWindow('a_clean_test_window');
  driver.get(TEST_PAGE.formPage);
  driver.back();
  assertThat(driver.getTitle(), equals("We Leave From Here"));
  driver.close();
}


function testShouldBeAbleToNavigateBackInTheBrowserHistory(driver) {
  driver.get(TEST_PAGE.formPage);
  driver.findElement({id: "imageButton"}).submit();
  assertThat(driver.getTitle(), equals("We Arrive Here"));
  driver.back();
  assertThat(driver.getTitle(), equals("We Leave From Here"));
}


function testShouldBeAbleToNavigateBackInTheBrowserHistoryInPresenceOfIframes(
    driver) {
  driver.get(TEST_PAGE.xhtmlTestPage);
  driver.findElement({name: "sameWindow"}).click();
  assertThat(driver.getTitle(), equals("This page has iframes"));
  driver.back();
  assertThat(driver.getTitle(), equals("XHTML Test Page"));
}


function testShouldBeAbleToNavigateForwardsInTheBrowserHistory(driver) {
  driver.get(TEST_PAGE.formPage);
  driver.findElement({id: "imageButton"}).submit();
  assertThat(driver.getTitle(), equals("We Arrive Here"));
  driver.back();
  assertThat(driver.getTitle(), equals("We Leave From Here"));
  driver.forward();
  assertThat(driver.getTitle(), equals("We Arrive Here"));
}


// TODO(jmleyba): This will suppress the test when _run_ on Firefox. But what if
// we're using a remote driver controlling something that isn't Firefox? We want
// the test to run in that case...
if (!goog.userAgent.GECKO) {
  var testShouldBeAbleToAccessPagesWithAnInsecureSslCertificate = function(
      driver) {
    var url = toSecureUrl(TEST_PAGE.simpleTestPage);
    driver.get(url);
    assertThat(driver.getTitle(), equals("Hello WebDriver"));
  };
}


function testShouldBeAbleToRefreshAPage(driver) {
  driver.get(TEST_PAGE.xhtmlTestPage);
  driver.refresh();
  assertThat(driver.getTitle(), equals("XHTML Test Page"));
}


function testShouldWaitForLoadsToCompleteAfterJavascriptCausesANewPageToLoad(
    driver) {
  driver.get(TEST_PAGE.formPage);
  driver.findElement(By.id('changeme')).setSelected();
  assertThat(driver.getTitle(), equals('Page3'));
}
  </script>
</head>
<body>
</body>
</html>
